# Removal Attack and Defense on AI Generated Content Latent-based Watermarking

This repository contains the code implementation of the attacks in the aforementioned paper.


## Setup

```bash
pip install -r requirements.txt
```

## Attacking Watermarked Latents Directly (i.e. perfect inversion)

### Usage

```bash 
python latent_space_encode_decode.py --test_num [test_num] --attack [attack] --eps_low [eps_low] --eps_high [eps_high] --n_eps [n_eps] --message_length [message_length]
```
This is the description arguments for the aforementioned command. 
| Argument | Values | Use |
|----------|--------|-----|
|--test_num|`int` | number of samples |
|--attack|`stealthy` `min_distortion` `white_noise`| the three attacks described in the paper|
|--nworkers|`int`| number of clients for federated learning|
|--eps_low|`float`| minimum perturbation added by attack|
|--eps_high|`float`| max perturbation added by attack|
|--n_eps|`int`| The attack is executed over `n_eps` choices of perturbation magnitude, which are generated by dividing the range between `eps_low` and `eps_high` into `n_eps` equally spaced values|
|--message_length|`int`| number of bits of watermarked message|


## Evaluation on Stable Diffusion 2.1

### Usage

```bash 
python encode_exact_invert_remove.py --test_num [test_num] --attack [attack] --eps [eps] --message_length [message_length] --inversion [inversion]
```
This is the description arguments for the aforementioned command. 
| Argument | Values | Use |
|----------|--------|-----|
|--test_num|`int` | number of samples |
|--attack|`stealthy` `min_distortion` `white_noise`| the three attacks described in the paper|
|--nworkers|`int`| number of clients for federated learning|
|--eps|`float`| perturbation added by attack|
|--message_length|`int`| number of bits of watermarked message|
|--inversion|`exact` `null` `prompt`| Inversion method used by attack (exact latent, inversion conditional on null prompt, inversion conditional on same prompt used to generate the image) |

## Acknowledgement

The code presented here largely reuse the code and default parameters used by the authors of the original PRC watermarking scheme,  provided [here](https://github.com/XuandongZhao/PRC-Watermark)
